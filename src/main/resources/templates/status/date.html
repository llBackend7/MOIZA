<html layout:decorate="~{layout/layout.html}" xmlns:layout="http://www.w3.org/1999/xhtml" xmlns="">

<body>

<header layout:fragment="header" class="sticky top-0">
    <div class="navbar max-w-2xl mx-auto bg-base-100">
        <div class="navbar-start">
            <button class="ml-4" onclick="location.href='/groups'">
                Home
            </button>
        </div>
        <div class="navbar-center">
        <span class="text-2xl">
          투표 및 현황
        </span>
        </div>
        <div class="navbar-end">
            <a id="close-btn" href="javascript:" th:if="${room.getLeader() == actor}" onclick="$(this).next().submit();" class="flex items-center justify-center">마감하기</a>
            <form hidden th:action="@{|/room/${room.id}/close|}" method="POST">
            </form>
        </div>
    </div>
    <script>
        /*<![CDATA[*/
        let calculatorUrl = '[[${calculatorUrl}]]';
        /*]]>*/
    </script>
</header>

<main layout:fragment="main" class="flex-grow flex items-center justify-center">
    <div class="max-w-2xl w-full bg-blue-50">

        <div class="text">
            <div class="title">모임이름</div>
            <div class="font-gsans w-1/2 flex justify-center text-2xl" th:text="${room.name}"></div>
        </div>

        <div class="date-rank">

            <div class="flex justify-center items-center m-2">
                <div class="text-center text-xl mr-2">
                    날짜 현황
                </div>
                <a th:href="@{|/room/${room.id}/changeTime|}" class="hover-pointer">
                    <i class="far fa-light fa-pen-to-square"></i>
                </a>
                <button onclick="getSelectedTimes();">LOAD</button>
            </div>

            <div th:if="${#lists.isEmpty(overlappingTimes)}" class="w-full flex flex-col items-center justify-center mt-4 text-xl font-gsans">
                가능한 시간이 없습니다. 가능 시간을 수정해보세요.
            </div>

            <div id="app">
                <div th:replace="~{status/times :: times}"></div>
            </div>
        </div>

        <div class="font-bold attend-status" id="members">
            <div class="flex justify-center">
                시간을 선택하면 멤버들의 참여 여부를 확인 할 수 있습니다.
            </div>
        </div>
    </div>
    <script>
        function showAllMembers(idx){
            const time = times[idx];
            $('#members').empty();
            $('#members').append(`
                <div>
                    <div class="mb-2">참여 멤버</div>
                    <ul class="flex justify-center">
                        ${showMembers(time.participationMembers)}
                    </ul>
                </div>

                <div>
                    <div class="mb-2">참여 불가능 멤버</div>
                    <ul class="flex justify-center">
                        ${showMembers(time.nonParticipationMembers)}
                    </ul>
                </div>
            `);
        }

        function showMembers(members) {
            let membersHTML = '';
            members.forEach(member=>membersHTML += `
                <li class="mr-2 flex flex-col items-center justify-center">
                    <div><img src="${member.profile}" width="50" class="mask mask-circle" style="z-index: 0"></div>
                    <div class="text-center">${member.name}</div>
                </li>
            `);
            return membersHTML;
        }
    </script>
</main>

</body>

<footer layout:fragment="footer">
    <a href=""><i class="far fa-thin fa-clock text-sky-600"></i></a>
    <a th:href="@{|/room/${room.id}/place|}"><i class="far fa-solid fa-location-dot text-slate-300 hover:text-sky-600"></i></a>
    <a th:href="@{|/room/${room.id}/chat|}"><i class="far fa-thin fa-comments hover:text-sky-600 text-slate-300"></i></a>
</footer>

</html>